function hash_file(a,b,c){function d(){for(e=0;e<b.length;e+=1)b[e].removeEventListener("message",k)}var e,f,g,h,i,j,k,l;for(i=new FileReader,l=function(a){if(!uploadDatas[c].isCanceled)for(e=0;e<b.length;e+=1)h+=1,b[e].postMessage({message:a.target.result,block:g})},k=function(b){h-=1,0===h&&g.end!==a.size&&(g.start+=f,g.end+=f,g.end>a.size&&(g.end=a.size,d()),i.onload=l,j=a.slice(g.start,g.end),i.readAsArrayBuffer(j))},f=2097152,g={file_size:a.size,start:0},g.end=f>a.size?a.size:f,h=0,e=0;e<b.length;e+=1)b[e].addEventListener("message",k);i.onload=l,j=a.slice(g.start,g.end),i.readAsArrayBuffer(j)}function handle_worker_event(a){return function(b){if(b.data.result){if(md5=b.data.result,uploadDatas[a].context.find(".rate").html("MD5计算：100%"),!uploadDatas[a].isCanceled){uploadDatas[a].md5=md5;for(var c=uploadDatas[a].files,d=0;d<c.length;d++){var e=c[d],f={index:a,name:e.name,size:e.size};window.parent.postMessage(f,"*")}}}else uploadDatas[a].context.find(".rate").html("MD5计算："+Math.round(100*b.data.block.end/b.data.block.file_size)+"%")}}function handle_file_select(a,b){a.context.find(".rate").html("MD5计算中");var c,d,e,f;for(d=a.files,c=0;c<d.length;c+=1)e=d[c],workers=[],f=new Worker("/plugins/ccUpload/upload_files/sparkmd5_worker.js"),f.addEventListener("message",handle_worker_event(b)),workers.push(f),hash_file(e,workers,b)}var file_id=0,drop_zone;"undefined"==typeof File||File.prototype.slice||(File.prototype.webkitSlice&&(File.prototype.slice=File.prototype.webkitSlice),File.prototype.mozSlice&&(File.prototype.slice=File.prototype.mozSlice)),window.File&&window.FileReader&&window.FileList&&window.Blob&&File.prototype.slice||alert("此浏览器不支持文件读取API. 请下载安装最新版本的Mozilla Firefox(火狐浏览器),Internet Explorer 10 (IE10)或者Google Chrome(谷歌浏览器).");